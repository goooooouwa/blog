<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.13 (455674)"/><meta name="keywords" content="Active Record, Associations, Elasticsearch"/><meta name="author" content="Greg Xu"/><meta name="created" content="2014-09-25 07:44:01 +0000"/><meta name="updated" content="2014-11-06 07:31:16 +0000"/><title>work with ActiveRecord associations in Elasticsearch</title></head><body><div>if model A has one or many model B( equals model B belongs to model A<span>)</span>, to update index of A when B gets updated, just write in B:</div><div><em>belongs_to A, touch: true</em></div><div><br clear="none"/></div><div><span>if model A belongs to model B( equals <span>model B has one or many model A)</span><span>,</span> to update index of A when B gets updated, just write in B:</span></div><div><em><span>has_many :As</span></em></div><div><em><span>after_update</span> <span>{</span> <span>self</span><span>.As</span><span>.</span><span>each</span><span>(</span><span>&amp;</span><span>:touch</span><span>)</span> <span>}</span></em></div><div><span><br clear="none"/></span></div><div><span>if model A<span> has</span> and belongs to many model B,<span> to update <span>index of </span>A when one of Bs gets updated, just write in A</span></span></div><div><em>has_and_belongs_to_many :Bs, after_add: [ lambda { |a,c| a.__elasticsearch__.index_document } ],<br clear="none"/> after_remove: [ lambda { |a,c| a.__elasticsearch__.index_document } ]</em></div><div>and in B</div><div><div><em>after_update { self.As.each(&amp;:touch) }</em></div></div></body></html>